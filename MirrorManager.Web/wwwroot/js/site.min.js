function checkFace(n){var t=canvas.toDataURL("image/jpeg",.9).split(",")[1];$.ajax({url:"/ajax/checkFace",type:"POST",data:JSON.stringify({image:t}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){n(t)},error:function(){writeError("There was some error while uploading Image");n(!1)}})}function linkFace(){$("#linkFace").attr("disabled","disabled");$("#linkFace").html("Checking face presence...");capture();checkFace(function(n){if(n!==!1)if(n.length===1){$("#linkFace").html("Uploading...");var t=canvas.toDataURL("image/jpeg",.9).split(",")[1];$.ajax({url:"/ajax/linkFace",type:"POST",data:JSON.stringify({image:t}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){n.error&&writeError(n.error);$("#linkFace").html("Captured successfully...");setTimeout(function(){$("#linkFace").removeAttr("disabled");$("#linkFace").html("Capture")},2e3)},error:function(){writeError("There was some error while uploading image");$("#linkFace").removeAttr("disabled");$("#linkFace").html("Capture")}})}else n.length===0?(alert("No face was detected in the picture, please try again!"),$("#linkFace").removeAttr("disabled"),$("#linkFace").html("Capture")):(alert("Only one face can be present in the picture!"),$("#linkFace").removeAttr("disabled"),$("#linkFace").html("Capture"));else $("#linkFace").removeAttr("disabled"),$("#linkFace").html("Capture")})}function deleteIdentity(){$("#linkFace").attr("disabled","disabled");$("#linkFace").attr("value","Deleting...");var n=canvas.toDataURL("image/jpeg",.9).split(",")[1];$.ajax({url:"/ajax/deleteIdentity",type:"POST",data:JSON.stringify({image:n}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){alert(JSON.stringify(n));$("#linkFace").removeAttr("disabled");$("#linkFace").attr("value","Delete identity")},error:function(){alert("There was some error while deleting identity");$("#linkFace").removeAttr("disabled");$("#linkFace").attr("value","Delete identity")}})}function getAvatar(){let n="/ajax/getAvatar";$.ajax({url:n}).success(function(){$("#avatar .win-navbarcommand-icon").css({"background-image":"url('"+n+"')","-ms-high-contrast-adjust":"none"}).fadeIn().html("");$("#avatar").addClass("user-image")})}var mediaStream=null,webcamList,currentCam=null,writeError=function(n){alert(n);console.error(n)},initializeVideoStream=function(n){mediaStream=n;var t=document.getElementById("video");t.srcObject=mediaStream;t.paused&&t.play();$("#capture").removeAttr("disabled");webcamList.length>1&&$("#switchCamera, #linkFace").removeAttr("disabled");$("#linkFace").removeAttr("disabled")},getUserMediaError=function(n){n.name.indexOf("NotFoundError")>=0?writeError("Webcam not found."):writeError('The following error occurred: "'+n.name+'" Please check your webcam device(s) and try again.')},capture=function(){var u;if(mediaStream){var n=document.getElementById("video"),t=document.getElementById("canvas"),i=n.videoWidth,r=n.videoHeight;(t.width!==i||t.height!==r)&&(t.width=i,t.height=r);u=t.getContext("2d");u.drawImage(n,0,0,n.videoWidth,n.videoHeight)}},nextWebCam=function(){var n,t;$("#switchCamera, #linkFace").attr("disabled","disabled");currentCam!==null?(currentCam++,currentCam>=webcamList.length&&(currentCam=0),n=document.getElementById("video"),typeof n.srcObject!="undefined"&&(n.srcObject=null),n.src=null,mediaStream&&(t=mediaStream.getVideoTracks(),t[0].stop(),mediaStream=null)):currentCam=0;navigator.mediaDevices.getUserMedia({video:{width:640,height:360,deviceId:{exact:webcamList[currentCam]}}}).then(initializeVideoStream).catch(getUserMediaError)},enumerateMediaDevices=function(){navigator.mediaDevices.enumerateDevices().then(devicesCallback).catch(getUserMediaError)},deviceChanged=function(){navigator.mediaDevices.removeEventListener("devicechange",deviceChanged);webcamList=[];enumerateMediaDevices()},devicesCallback=function(n){webcamList=[];for(var t=0;t<n.length;t++)n[t].kind==="videoinput"&&(webcamList[webcamList.length]=n[t].deviceId);webcamList.length>0?(nextWebCam(),webcamList.length>1?$("#switchCamera").removeAttr("disabled"):$("#switchCamera").attr("disabled","disabled")):writeError("Webcam not found.");navigator.mediaDevices.addEventListener("devicechange",deviceChanged)},initWebcam=function(){if(navigator.getUserMedia){enumerateMediaDevices();$("#switchCamera").on("click",nextWebCam);$("#linkFace").on("click",linkFace);$("#deleteIdentity").on("click",deleteIdentity)}else writeError("You are using a browser that does not support the Media Capture API")};WinJS.UI.processAll().done(function(){var t=document.querySelector(".splitView").winControl,n;new WinJS.UI._WinKeyboard(t.paneElement);getAvatar();n=document.getElementById("avatar");n.addEventListener("click",function(){var t=document.getElementById("userMenu").winControl;t.show(n,"top")})});